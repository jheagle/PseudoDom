"use strict";require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.symbol.iterator.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.PseudoEventTarget=void 0,require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/es.object.assign.js"),require("core-js/modules/es.array.splice.js");const _PseudoEvent=require("./PseudoEvent"),_PseudoEventListener=require("./PseudoEventListener");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(let n=0;n<t.length;n++){const s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}const PseudoEventTarget=function(){function e(){_classCallCheck(this,e),this.listeners=[],this.defaultEvent=[]}return _createClass(e,[{key:"runEvents",value:function(e){if(!(e.type in this.listeners))return!0;const t=this.listeners[e.type];let n=null;return this.listeners[e.type]=t.reduce((function(t,s){return e.immediatePropagationStopped||s.rejectEvent(e)?t.concat(s):(n=s.handleEvent(e),s.eventOptions.once?(e.currentTarget.removeEventListener(e.eventType,e.handleEvent),t):t.concat(s))}),[]),n}},{key:"setDefaultEvent",value:function(e,t){const n=this;e in this.listeners||(this[e]=function(){return n.startEvents(e)},this.listeners[e]=[]),this.defaultEvent[e]=t}},{key:"runDefaultEvent",value:function(e){if(e.defaultPrevented)return!1;this.defaultEvent[e.type](e)}},{key:"startEvents",value:function(e){const t=this,n=new _PseudoEvent.PseudoEvent(e);return n.setReadOnlyProperties({target:this}),console.log("startEvents",n.type,n.target),[_PseudoEvent.PseudoEvent.CAPTURING_PHASE,_PseudoEvent.PseudoEvent.AT_TARGET,_PseudoEvent.PseudoEvent.BUBBLING_PHASE].forEach((function(s){let r=null;s!==_PseudoEvent.PseudoEvent.AT_TARGET&&n.propagationStopped||(n.setReadOnlyProperties({eventPhase:s}),n.composedPath().forEach((function(e){n.setReadOnlyProperties({currentTarget:e}),r=n.currentTarget.runEvents(n)}))),n.eventPhase===_PseudoEvent.PseudoEvent.AT_TARGET&&"boolean"!=typeof r&&t.defaultEvent[e]&&t.runDefaultEvent(n)})),!0}},{key:"addEventListener",value:function(e,t){const n=this,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];let r={capture:!1,once:!1,passive:!1};"object"===_typeof(s)?r=Object.keys(s).reduce((function(e,t){return e[t]=s[t],e}),r):r.capture=s,e in this.listeners||(this[e]=function(){return n.startEvents(e)},this.listeners[e]=[]),this.listeners[e]=this.listeners[e].concat([Object.assign(Object.create(_PseudoEventListener.PseudoEventListener),_PseudoEventListener.PseudoEventListener,{eventType:e,eventOptions:Object.assign({},_PseudoEventListener.PseudoEventListener.eventOptions,r),handleEvent:(t.handleEvent||t).bind(this)})]);const o=this.listeners[e].reduce((function(e,t){return t.isDefault?Object.assign({},e,{default:e.default.concat([t])}):Object.assign({},e,{explicit:e.explicit.concat([t])})}),{explicit:[],default:[]});this.listeners[e]=[].concat(o.explicit,o.default)}},{key:"removeEventListener",value:function(e,t){if(!(e in this.listeners))return;const n=this.listeners[e];for(let e=0,s=n.length;e<s;e++)if(n[e].handleEvent===t&&!n[e].isDefault)return void n.splice(e,1)}},{key:"dispatchEvent",value:function(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return e.setReadOnlyProperties({target:t}),!(e.type in this.listeners)||(this.runEvents(e),!e.defaultPrevented)}}]),e}();exports.PseudoEventTarget=PseudoEventTarget;